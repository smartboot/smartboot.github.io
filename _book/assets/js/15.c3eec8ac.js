(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{338:function(s,t,a){s.exports=a.p+"assets/img/eventbus.23a2ee40.png"},384:function(s,t,a){"use strict";a.r(t);var e=a(7),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("smart-mqtt 所有的数据、服务都是依托于事件总线驱动的。\n数据总线造就了 smart-mqtt 极具灵活的扩展性，熟练掌握并运用该特性可以轻松应对各类复杂的场景需求。\n"),t("img",{attrs:{src:a(338),alt:""}})]),s._v(" "),t("h2",{attrs:{id:"接口设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#接口设计"}},[s._v("#")]),s._v(" 接口设计")]),s._v(" "),t("p",[s._v("从消息总线的接口设计可以看出，它的运作原理就是经典的生产/消费模型。")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EventBus")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("subscribe")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EventType")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EventBusSubscriber")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" subscriber"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("subscribe")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EventType")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" types"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EventBusSubscriber")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" subscriber"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("publish")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EventType")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" eventType"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("其中"),t("code",[s._v("EventBus#publish")]),s._v("已被安插在各个恰当的位置，当发生相应事件的时候会由 smart-mqtt 框架自动触发。")]),s._v(" "),t("p",[s._v("为了实现 MQTT Broker 的基础功能，smart-mqtt 已经通过"),t("code",[s._v("EventBus#subscribe")]),s._v("订阅了部分事件。")]),s._v(" "),t("p",[s._v("当然，当你"),t("RouterLink",{attrs:{to:"/smart-mqtt/plugins.html"}},[s._v("开发插件")]),s._v("的时候，也可以通过订阅关注的事件实现自己想要的功能。\n但在此之前，最好先了解下各个事件类型的特性及触发条件。")],1),s._v(" "),t("h2",{attrs:{id:"事件类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#事件类型"}},[s._v("#")]),s._v(" 事件类型")]),s._v(" "),t("h3",{attrs:{id:"接收消息-receive-message"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#接收消息-receive-message"}},[s._v("#")]),s._v(" 接收消息（RECEIVE_MESSAGE）")]),s._v(" "),t("p",[s._v("触发条件：完成MQTT消息解码，并即将进行消息处理时。")]),s._v(" "),t("h3",{attrs:{id:"输出消息-write-message"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#输出消息-write-message"}},[s._v("#")]),s._v(" 输出消息（WRITE_MESSAGE）")]),s._v(" "),t("p",[s._v("触发条件：即将往TCP通道发送一条消息。")]),s._v(" "),t("h3",{attrs:{id:"broker启动服务-broker-started"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#broker启动服务-broker-started"}},[s._v("#")]),s._v(" Broker启动服务（BROKER_STARTED）")]),s._v(" "),t("p",[s._v("触发条件：Broker服务完成初始化，并启动成功。")]),s._v(" "),t("h3",{attrs:{id:"broker停止服务-broker-destroy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#broker停止服务-broker-destroy"}},[s._v("#")]),s._v(" Broker停止服务（BROKER_DESTROY）")]),s._v(" "),t("p",[s._v("触发条件：Broker 停止服务。")]),s._v(" "),t("h3",{attrs:{id:"connect"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#connect"}},[s._v("#")]),s._v(" CONNECT")]),s._v(" "),t("p",[s._v("触发条件：客户端发送的 ConnectMessage 认证通过。")]),s._v(" "),t("h3",{attrs:{id:"disconnect"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#disconnect"}},[s._v("#")]),s._v(" DISCONNECT")]),s._v(" "),t("p",[s._v("触发条件：客户端与Broker的TCP连接断开。")]),s._v(" "),t("h3",{attrs:{id:"会话初始化-session-create"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#会话初始化-session-create"}},[s._v("#")]),s._v(" 会话初始化（SESSION_CREATE）")]),s._v(" "),t("p",[s._v("触发条件：建立了新的 TCP 连接，并完成 MQTT Session 初始化。")]),s._v(" "),t("h3",{attrs:{id:"创建topic实例-topic-create"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建topic实例-topic-create"}},[s._v("#")]),s._v(" 创建Topic实例（TOPIC_CREATE）")]),s._v(" "),t("p",[s._v("触发条件：Broker 接收到一个新的Topic订阅。")]),s._v(" "),t("h3",{attrs:{id:"订阅topic-subscribe-topic"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#订阅topic-subscribe-topic"}},[s._v("#")]),s._v(" 订阅Topic（SUBSCRIBE_TOPIC）")]),s._v(" "),t("p",[s._v("触发条件：客户端连接订阅了某个Topic。")]),s._v(" "),t("h3",{attrs:{id:"receive-publish-message"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#receive-publish-message"}},[s._v("#")]),s._v(" RECEIVE_PUBLISH_MESSAGE")]),s._v(" "),t("p",[s._v("触发条件：Broker收到来自客户端发送的 PublishMessage。")]),s._v(" "),t("h3",{attrs:{id:"push-publish-message"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#push-publish-message"}},[s._v("#")]),s._v(" PUSH_PUBLISH_MESSAGE")]),s._v(" "),t("p",[s._v("触发条件：Broker向某个客户端连接推送一次订阅的消息。")])])}),[],!1,null,null,null);t.default=n.exports}}]);