---
title: ğŸ’“å¿ƒè·³æ’ä»¶ï¼šHeartPlugin
date: 2022-11-02 13:16:07
permalink: /smart-socket/plugin-heart.html
---
å½“å‡ºç°éæ­£å¸¸çš„ç½‘ç»œæ–­è¿ï¼Œé€šä¿¡åŒæ–¹å¯èƒ½æ— æ³•æ„ŸçŸ¥åˆ°è¯¥æƒ…å†µï¼ˆè­¬å¦‚æ‹”ç½‘çº¿ã€æœåŠ¡å™¨æ–­ç”µï¼‰ã€‚
æ­¤æ—¶éœ€è¦é€šè¿‡ä¸šåŠ¡å±‚é¢çš„å¿ƒè·³æ¶ˆæ¯æ„ŸçŸ¥å¼‚å¸¸å¹¶é‡Šæ”¾ç½‘ç»œèµ„æºã€‚
## æ„é€ å‚æ•°
- heartRateï¼šå¿ƒè·³é¢‘ç‡ï¼Œæ¯éš” hearRate æ—¶é•¿å‘é€ä¸€æ¬¡å¿ƒè·³æ¶ˆæ¯ã€‚
- timeoutï¼šè¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡ timeout æ—¶é•¿æ²¡æ”¶åˆ°ä»»ä½•æ¶ˆæ¯åˆ™è§¦å‘è¶…æ—¶å›è°ƒ`timeoutCallback`ã€‚
- timeUnitï¼šheartRate å’Œ timeout å‚æ•°çš„æ—¶é—´å•ä½ã€‚
- timeoutCallbackï¼šè¶…æ—¶å›è°ƒæ–¹æ³•ï¼Œé»˜è®¤æ–­å¼€ç½‘ç»œè¿æ¥ï¼Œæ”¯æŒè‡ªå®šä¹‰å®ç°ã€‚

## æ¥å£
- sendHeartRequestï¼šå‘é€å¿ƒè·³æ¶ˆæ¯ï¼Œå½“ç©ºé—²æ—¶é•¿è¶…è¿‡ heartRate æ—¶è§¦å‘ã€‚
- isHeartMessageï¼šæ¥æ”¶åˆ°çš„æ¶ˆæ¯æ˜¯å¦ä¸ºå¿ƒè·³æ¶ˆæ¯ã€‚è‹¥ä¸ºå¿ƒè·³æ¶ˆæ¯ï¼Œå°†ä¸ä¼šè¿›å…¥ `MessageProcessor#process`æ–¹æ³•ã€‚

## ç¤ºä¾‹
å®Œæ•´ç¤ºä¾‹è§ï¼š[HeartPluginDemo](https://gitee.com/smartboot/smart-socket/blob/master/example/src/main/java/org/smartboot/socket/example/plugins/HeartPluginDemo.java)
```java
processor.addPlugin(new HeartPlugin<String>(5, 7, TimeUnit.SECONDS) {
    @Override
    public void sendHeartRequest(AioSession session) throws IOException {
        WriteBuffer writeBuffer = session.writeBuffer();
        byte[] content = "heart message".getBytes();
        writeBuffer.writeInt(content.length);
        writeBuffer.write(content);
    }

    @Override
    public boolean isHeartMessage(AioSession session, String msg) {
        return "heart message".equals(msg);
    }
});
```