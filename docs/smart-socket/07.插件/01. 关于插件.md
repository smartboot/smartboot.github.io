---
title: 1. å…³äºæ’ä»¶ğŸ’¬
date: 2022-11-01 22:36:52
permalink: /smart-socket/plugins.html
---
## å‰è¨€
NetMonitor æ˜¯ smart-socket ä¸‰å¤§æ ¸å¿ƒæ¥å£ä¸­æœ€ä¸ä¸ºäººæ‰€å…³æ³¨çš„ä¸€ä¸ªã€‚ä½†å®ƒå´æ˜¯å…¶ä¸­åŠŸèƒ½æœ€å¼ºå¤§çš„ï¼Œsmart-socket çš„æ’ä»¶åŒ–èƒ½åŠ›æ­£æ˜¯ä»ä¸­æ¼”åŒ–è€Œæ¥ã€‚

![](./img/interfaces.png)

## Pluginæ¥å£è®¾è®¡
NetMonitor å®šä¹‰çš„æ–¹æ³•ä¸»è¦æ˜¯é’ˆå¯¹ I/O æ“ä½œç›¸å…³çš„åˆ‡é¢ï¼Œå½“å¯¹åº”çš„äº‹ä»¶å³å°†æˆ–å·²ç»è¢«æ‰§è¡Œæ—¶ï¼Œä¼šè§¦å‘ smart-socket çš„å›è°ƒåŠ¨ä½œã€‚å…·ä½“æ¥å£è®¾è®¡å¦‚ä¸‹ï¼š
![](./img/netmonitor.png)
ä»… NetMonitor å·²æœ‰çš„è®¾è®¡ï¼Œè¿˜ä¸è¶³ä»¥æ”¯æ’‘èµ·æ’ä»¶åŒ–åŠŸèƒ½çš„å„é¡¹è¦æ±‚ï¼Œæ‰€ä»¥ smart-socket ä¸“é—¨å®šä¹‰äº†æ’ä»¶æ¥å£ï¼šPluginã€‚
è¯¥æ¥å£ç»§æ‰¿è‡ª NetMonitorï¼Œå¹¶æ–°å¢äº†ä¸¤ä¸ªæ–¹æ³•ï¼ˆè§ä¸‹å›¾ï¼‰ã€‚
![](./img/plugin.png)

## è‡ªå®šä¹‰æ’ä»¶
å®šä¹‰æ’ä»¶ï¼Œè¯´ç™½äº†å°±æ˜¯å®ç° Plugin æ¥å£ã€‚æ ¹æ®ä½ çš„å®é™…éœ€æ±‚ï¼Œç¼–å†™ Plugin å„æ–¹æ³•çš„æ‰§è¡Œé€»è¾‘ã€‚

é™¤äº† Plugin åŸæœ‰çš„æ–¹æ³•ï¼Œä½ è¿˜å¯ä»¥åœ¨å®ç°ç±»ä¸­è¿›ä¸€æ­¥æ‰©å±•æœ¬æ’ä»¶çš„æ–¹æ³•ï¼Œä»¥ä¾›å¤–éƒ¨è°ƒç”¨ã€‚

ä»¥ smart-socket è‡ªå¸¦çš„é»‘åå•æ’ä»¶ BlackListPlugin ä¸ºä¾‹ï¼Œå®ƒä¸ä»…å®ç°äº† Plugin å®šä¹‰çš„æ–¹æ³•ï¼Œè¿˜å¢åŠ äº†ä¸¤ä¸ªæ–¹æ³•ï¼š
  - addRuleï¼šæ·»åŠ é»‘åå•è§„åˆ™
  - removeRuleï¼šç§»é™¤é»‘åå•è§„åˆ™ã€‚

å½“å¯ç”¨è¿™ä¸ªæ’ä»¶åï¼Œå‡¡æ˜¯åŒ¹é…é»‘åå•è§„åˆ™çš„è¿æ¥è¯·æ±‚éƒ½å°†ç›´æ¥è¢«æ‹’ç»ã€‚

![](./img/blacklistplugin.png)

ä¸ºèƒ½å¤Ÿæ»¡è¶³ä¸åŒåœºæ™¯çš„é€šä¿¡éœ€æ±‚ï¼Œsmart-socket å·²ç»å†…ç½®äº†ä¸€äº›æ¯”è¾ƒå®ç”¨çš„æ’ä»¶ï¼Œå¼€ç®±å³ç”¨ï¼š
- BlackListPluginï¼šé»‘åå•æ’ä»¶ï¼Œç”¨äºæ‹’ç»ä¸åˆè§„çš„ç½‘ç»œè¿æ¥ã€‚
- HeartPluginï¼šå¿ƒè·³æ’ä»¶ã€‚
- MonitorPluginï¼šç½‘ç»œç›‘æ§æ’ä»¶ï¼Œç›‘æ§è¿æ¥æ•°ã€æµé‡ã€æ¶ˆæ¯å¤„ç†æƒ…å†µã€‚
- SslPluginï¼šTLS/SSL é€šä¿¡æ’ä»¶ã€‚
- SocketOptionPluginï¼šé€šé“è¿æ¥å±æ€§é…ç½®æ’ä»¶ã€‚

![](./img/abstract_plugin.png)
> å¦‚æœä½ æœ‰å…¶ä»–æ–¹é¢çš„æ’ä»¶éœ€æ±‚ï¼Œå¯ä»¥è‡ªå·±å®ç° Plugin æ¥å£ï¼Œæˆ–è€…ç»™æˆ‘ä»¬æéœ€æ±‚ã€‚

## å¯ç”¨æ’ä»¶
æ’ä»¶å®šä¹‰å‡ºæ¥åï¼Œè¿˜éœ€å°†å…¶æ³¨å†Œè‡³é€šä¿¡æœåŠ¡ä¸­æ–¹å¯ç”Ÿæ•ˆã€‚è¿™ä¸ªæ—¶å€™éœ€è¦ä¾èµ–å®ç°äº† MessageProcessor æ¥å£çš„æŠ½è±¡ç±»ï¼šAbstractMessageProcessorã€‚
> æ³¨æ„ï¼šä¹‹å‰è¿›è¡Œé€šä¿¡å¼€å‘è¦æ±‚å®ç° MessageProcessor æ¥å£ï¼Œä½†å¦‚æœéœ€è¦å¯ç”¨æ’ä»¶ï¼Œå¿…é¡»å¾—ç»§æ‰¿ AbstractMessageProcessor ç±»ã€‚

![](./img/register_plugin.png)
è°ƒç”¨ AbstractMessageProcessor#addPlugin æ–¹æ³•å¯ä»¥å°†æŸä¸ªæ’ä»¶æ³¨å†Œè‡³é€šä¿¡æœåŠ¡ä¸­ï¼Œ
è¯¥æ’ä»¶ä¼šè¢«å­˜æ”¾åˆ° AbstractMessageProcessor å†…ç½®çš„ List æˆå‘˜å˜é‡ pluginsï¼ŒæœåŠ¡å¯åŠ¨å³å¯ç”Ÿæ•ˆã€‚

